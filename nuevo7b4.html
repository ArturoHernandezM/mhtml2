<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Memorama de sonidos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #010429;
    color: white;
    text-align: center;
    margin: 0;
    padding: 0;
  }

  h1 {
    margin-top: 22px;
  }

  #stats {
    margin: 11px;
    font-size: 1.2em;
  }

  #game-board {
    display: grid;
    grid-template-columns: repeat(4, 130px);
    grid-gap: 15px;
    justify-content: center;
    margin-top: 25px;
  }

  .card {
    width: 120px;
    height: 120px;
    background-color: #7c6fed;
    border-radius: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 2em;
    transition: transform 0.3s, opacity 0.8s;
  }

  .card.flipped {
    background-color: #00aa88;
    transform: scale(1.05);
  }

  .card.matched {
    opacity: 0;
    pointer-events: none;
  }

  #reset-btn {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 1em;
    border: none;
    border-radius: 8px;
    background-color: #00aaff;
    color: white;
    cursor: pointer;
  }

  #reset-btn:hover {
    background-color: #0077cc;
  }

  #game-over {
    font-size: 1.5em;
    margin-top: 20px;
  }
</style>
</head>
<body>

<h1>Memorama de motivos mel√≥dicos üé∂</h1>
<div id="stats">
  ‚è±Ô∏è Tiempo: <span id="time">0</span> s |
  ‚ùå Errores: <span id="errors">0</span>/7
</div>
<div id="game-board"></div>
<button id="reset-btn">Reiniciar</button>
<div id="game-over"></div>

<script>
const sounds = [
  "1.mp3", "2.mp3", "3.mp3", "4.mp3", "5.mp3", "6.mp3"
];

let cards = [];
let flippedCards = [];
let matchedCount = 0;
let errors = 0;
let timer = 0;
let timerInterval = null;
let timerStarted = false;
const maxErrors = 7;

// DOM
const board = document.getElementById("game-board");
const timeDisplay = document.getElementById("time");
const errorsDisplay = document.getElementById("errors");
const gameOverDisplay = document.getElementById("game-over");

// üëâ Crear overlay con blur, pero sin bloquear el bot√≥n de reinicio
const overlay = document.createElement("div");
overlay.style.position = "absolute";
overlay.style.top = "0";
overlay.style.left = "0";
overlay.style.width = "100%";
overlay.style.height = "100%";
overlay.style.display = "none";
overlay.style.alignItems = "center";
overlay.style.justifyContent = "center";
overlay.style.backdropFilter = "blur(8px)";
overlay.style.backgroundColor = "rgba(0, 0, 0, 0.3)";
overlay.style.zIndex = "5";
overlay.style.pointerEvents = "none"; // üëà permite clics pasar al bot√≥n debajo
overlay.innerHTML = `
  <div style="text-align:center; color:white; pointer-events:all;">
    <div id="win-text" style="font-size:2.2em; margin-bottom:10px;">üéâ ¬°Lo lograste!</div>
    <div style="font-size:0.9em; color:#ddd;">
      Material did√°ctico elaborado por el DTI. Arturo Hern√°ndez Maldonado.
    </div>
  </div>
`;
document.body.appendChild(overlay);

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function startGame() {
  board.innerHTML = "";
  overlay.style.display = "none";
  board.style.filter = "none";
  gameOverDisplay.textContent = "";
  flippedCards = [];
  matchedCount = 0;
  errors = 0;
  timer = 0;
  timerStarted = false;
  clearInterval(timerInterval);
  timeDisplay.textContent = "0";
  errorsDisplay.textContent = "0";

  const gameSounds = shuffle([...sounds, ...sounds]);

  gameSounds.forEach((src) => {
    const card = document.createElement("div");
    card.classList.add("card");
    card.dataset.sound = src;
    card.textContent = "üéµ";
    card.addEventListener("click", () => flipCard(card));
    board.appendChild(card);
  });
}

function startTimer() {
  timerInterval = setInterval(() => {
    timer++;
    timeDisplay.textContent = timer;
  }, 1000);
}

function playSound(src) {
  const audio = new Audio(src);
  audio.currentTime = 0;
  audio.play();
}

function flipCard(card) {
  if (!timerStarted) {
    startTimer();
    timerStarted = true;
  }

  if (card.classList.contains("flipped") || card.classList.contains("matched") || flippedCards.length === 2) return;

  card.classList.add("flipped");
  playSound(card.dataset.sound);
  flippedCards.push(card);

  if (flippedCards.length === 2) {
    const [first, second] = flippedCards;
    if (first.dataset.sound === second.dataset.sound) {
      setTimeout(() => {
        first.classList.add("matched");
        second.classList.add("matched");
        matchedCount++;
        flippedCards = [];
        if (matchedCount === sounds.length) endGame(true);
      }, 500);
    } else {
      errors++;
      errorsDisplay.textContent = errors;
      setTimeout(() => {
        first.classList.remove("flipped");
        second.classList.remove("flipped");
        flippedCards = [];
        if (errors >= maxErrors) endGame(false);
      }, 800);
    }
  }
}

function endGame(won) {
  clearInterval(timerInterval);
  if (won) {
    board.style.filter = "blur(5px)";
    overlay.style.display = "flex";
  } else {
    gameOverDisplay.textContent = `üíÄ Juego terminado. Excediste ${maxErrors} errores.`;
  }
  document.querySelectorAll(".card").forEach(c => c.style.pointerEvents = "none");
}

document.getElementById("reset-btn").addEventListener("click", startGame);
startGame();
</script>

</body>
</html>
